<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Portal Asesmen & GeoAR ‚Äî Satu Halaman</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet" />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root{
      --brand:#2563eb;
      --brand-2:#1e40af;
    }
    html,body{height:100%}
    body{font-family:'Poppins',system-ui,Segoe UI,Roboto,Arial,sans-serif;background:#0f172a;color:#0b1220}
    /* Loading */
    #loading{
      position:fixed;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;
      background:radial-gradient(1200px 600px at 50% -10%, #1e293b, #0b1220 60%, #020617);
      z-index:50;color:#e5e7eb;text-align:center;gap:22px
    }
    .spin{width:46px;height:46px;border-radius:9999px;border:4px solid rgba(255,255,255,.12);border-top-color:#fff;animation:spin 1s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}
    /* Cards / Buttons */
    .card{
      background:linear-gradient(180deg,#0b1220 0%,#0b1220dd 60%,#0b1220cc 100%);border:1px solid rgba(255,255,255,.08);
      box-shadow:0 10px 40px rgba(0,0,0,.35);backdrop-filter:blur(6px);border-radius:18px
    }
    .btn{
      display:inline-flex;align-items:center;justify-content:center;gap:10px;padding:14px 18px;border-radius:14px;font-weight:700;
      background:linear-gradient(135deg,var(--brand),var(--brand-2));color:#fff;box-shadow:0 10px 24px rgba(37,99,235,.35);
      transition:.2s transform ease,.2s box-shadow ease
    }
    .btn:hover{transform:translateY(-1px);box-shadow:0 14px 32px rgba(37,99,235,.45)}
    .btn.secondary{background:linear-gradient(135deg,#10b981,#059669);box-shadow:0 10px 24px rgba(16,185,129,.35)}
    .btn.soft{
      background:#111827;color:#e5e7eb;border:1px solid rgba(255,255,255,.08);box-shadow:none
    }
    /* Iframe container */
    #stage{height:70vh}
    #appFrame{width:100%;height:100%;border:0;border-radius:16px;background:#fff}
    /* Topbar */
    .topbar{
      position:sticky;top:0;z-index:40;background:rgba(2,6,23,.7);backdrop-filter:blur(10px);
      border-bottom:1px solid rgba(255,255,255,.06)
    }
    /* Hide/show helpers */
    .hidden{display:none !important}
  </style>
</head>
<body>
  <!-- Loading Screen -->
  <div id="loading">
    <img src="https://iili.io/F5PvxlR.png" alt="Logo" style="width:120px;height:auto;filter:drop-shadow(0 6px 18px rgba(0,0,0,.5))" />
    <div class="spin"></div>
    <div>
      <h1 class="text-2xl font-bold tracking-wide">Memuat Portal‚Ä¶</h1>
      <p class="opacity-80">Menyiapkan menu & konten</p>
    </div>
  </div>

  <!-- App -->
  <div id="app" class="min-h-screen hidden">
    <!-- Topbar -->
    <div class="topbar">
      <div class="max-w-6xl mx-auto px-4 py-3 flex items-center gap-3">
        <img src="https://iili.io/F5PvxlR.png" alt="Logo" class="w-9 h-9 rounded-md" />
        <div class="flex-1">
          <h2 class="text-white font-bold leading-tight">Portal Asesmen & GeoAR</h2>
          <p class="text-white/60 text-xs">Satu halaman, semua fitur</p>
        </div>
        <button id="btnHome" class="btn soft text-sm px-4 py-2">üè† Beranda</button>
      </div>
    </div>

    <!-- Hero / Menu Utama -->
    <section id="home" class="max-w-6xl mx-auto px-4 py-10">
      <div class="grid md:grid-cols-2 gap-6">
        <div class="card p-6 md:p-8">
          <h3 class="text-white text-xl md:text-2xl font-bold mb-3">Asesmen Awal</h3>
          <p class="text-white/70 mb-6">Pilih jenis asesmen di bawah ini.</p>
          <div class="grid sm:grid-cols-2 gap-3">
            <button class="btn" data-load="labirin.txt">üéÆ Game Labirin</button>
            <button class="btn secondary" data-load="minat.txt">üê† Game Ikan (Minat)</button>
          </div>
        </div>

        <div class="card p-6 md:p-8">
          <h3 class="text-white text-xl md:text-2xl font-bold mb-3">GeoAR</h3>
          <p class="text-white/70 mb-6">Jelajahi modul GeoAR.</p>
          <button class="btn" data-load="geo.txt">üåç Buka GeoAR</button>
        </div>
      </div>
    </section>

    <!-- Stage (penampil konten) -->
    <section id="viewer" class="max-w-6xl mx-auto px-4 pb-12 hidden">
      <div class="mb-4 flex items-center justify-between">
        <div class="flex items-center gap-3">
          <button id="backToMenu" class="btn soft px-4 py-2 text-sm">‚¨ÖÔ∏è Kembali</button>
          <h3 id="nowTitle" class="text-white text-lg font-semibold">Memuat‚Ä¶</h3>
        </div>
        <div class="flex items-center gap-2">
          <button id="reloadFrame" class="btn soft px-3 py-2 text-sm">üîÑ Muat Ulang</button>
          <button id="openNewTab" class="btn soft px-3 py-2 text-sm">üóó Buka Tab</button>
        </div>
      </div>

      <div id="stage" class="card p-2">
        <iframe id="appFrame" title="Penampil Konten"></iframe>
      </div>

      <p class="text-white/50 text-xs mt-3">
        Tip: Jika konten terlihat tidak penuh, scroll di dalam jendela atau putar perangkat ke mode landscape.
      </p>
    </section>
  </div>

  <script>
    // --- Helpers
    const $ = (sel, root=document) => root.querySelector(sel);
    const $$ = (sel, root=document) => [...root.querySelectorAll(sel)];

    const loading = $('#loading');
    const app = $('#app');
    const home = $('#home');
    const viewer = $('#viewer');
    const appFrame = $('#appFrame');
    const nowTitle = $('#nowTitle');

    const ROUTES = {
      "labirin.txt": { title: "Game Labirin ‚Äî Asesmen Gaya Belajar" },
      "minat.txt":   { title: "Game Ikan ‚Äî Survei Minat Belajar" },
      "geo.txt":     { title: "GeoAR Learning" }
    };

    function show(section){
      for(const el of [home, viewer]) el.classList.add('hidden');
      section.classList.remove('hidden');
      window.scrollTo({top:0,behavior:'smooth'});
    }

    async function loadIntoFrame(path){
      nowTitle.textContent = ROUTES[path]?.title || "Memuat konten‚Ä¶";
      appFrame.srcdoc = `
        <!doctype html><html><head>
          <meta charset="utf-8" />
          <meta name="viewport" content="width=device-width,initial-scale=1" />
          <style>
            html,body{height:100%}body{display:flex;align-items:center;justify-content:center;font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif}
          </style>
        </head><body>Memuat <b>${path}</b>‚Ä¶</body></html>
      `;

      try{
        const res = await fetch(path, {cache:'no-store'});
        if(!res.ok) throw new Error(`Gagal memuat ${path} (${res.status})`);
        const html = await res.text();

        // Set srcdoc dengan konten asli berkas
        appFrame.srcdoc = html;

        // Simpan versi blob agar bisa "Buka Tab"
        const blob = new Blob([html], {type:'text/html'});
        const url = URL.createObjectURL(blob);
        appFrame.dataset.blobUrl = url;
      }catch(err){
        appFrame.srcdoc = `
          <!doctype html><html><head>
            <meta charset="utf-8" />
            <meta name="viewport" content="width=device-width,initial-scale=1" />
            <style>body{font-family:system-ui;padding:24px;color:#111}</style>
          </head><body>
            <h1>Gagal Memuat</h1>
            <p>${err.message}</p>
            <p>Pastikan berkas <code>${path}</code> berada di folder yang sama dengan file HTML ini.</p>
          </body></html>
        `;
        appFrame.removeAttribute('data-blob-url');
      }
    }

    // --- Event wiring
    $('#btnHome').addEventListener('click', ()=>show(home));
    $('#backToMenu').addEventListener('click', ()=>show(home));
    $('#reloadFrame').addEventListener('click', ()=>{
      const current = Object.keys(ROUTES).find(key => ROUTES[key].title === nowTitle.textContent) || appFrame.getAttribute('data-current');
      if(current) loadIntoFrame(current);
    });
    $('#openNewTab').addEventListener('click', ()=>{
      const url = appFrame.dataset.blobUrl;
      if(url) window.open(url, '_blank');
      else alert('Konten belum siap dibuka di tab baru.');
    });

    // Listener untuk tombol-tombol menu
    $$('#home [data-load]').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        const path = btn.getAttribute('data-load');
        appFrame.setAttribute('data-current', path);
        show(viewer);
        loadIntoFrame(path);
      });
    });

    // --- Boot
    window.addEventListener('load', ()=>{
      setTimeout(()=>{
        loading.classList.add('hidden');
        app.classList.remove('hidden');
      }, 500); // sedikit jeda agar transisi terasa halus
    });
  </script>
</body>
</html>
